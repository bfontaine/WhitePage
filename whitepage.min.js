$(function(){var c={save:"Save",saved:"Saved :)",saving_error:"Oops! an error occurred while saving :(",edit:"Edit",retrieve_error:"Oops! an error occurred while retrieving your content :("},f=document.body,i=document.getElementById("whitepage"),h=false,j="",m=document.createElement("button"),k=document.createElement("div"),e=document.createElement("span"),o=false;function b(){$.ajax("api.php?retrieve=1",{dataType:"json",success:function(q){if(q.error){p(c.retriving_error,"error")}q=q.data;i.innerHTML=j=q?q:""},error:p.bind(null,c.retrieving_error,"error")})}function g(q){if(j===i.innerHTML){return}$.ajax("api.php?save=1",{dataType:"json",type:"POST",data:{text:i.innerHTML},success:function(s){if(s.error){p(c.saving_error,"error")}else{j=s.data;p(c.saved,"success")}if(q instanceof Function){q()}},error:p.bind(null,c.saving_error,"error")})}function d(){g();i.removeAttribute("contenteditable");h=false;m.textContent=c.edit;m.onclick=l}function a(){if(j==i.innerHTML){return}g(function(){window.setTimeout(a,10000)})}function l(){if(h){return}h=true;i.setAttribute("contenteditable",true);i.focus();m.textContent=c.save;m.onclick=d;window.setTimeout(a,10000)}function n(q){if(!o){return}$(k).animate({top:"-500px"},{duration:2000,complete:function(){e.textContent="";o=false;if(q instanceof Function){q()}}})}function p(r,q){if(o){if(r===e.textContent){return}return n(p.bind(null,r,q))}e.textContent=r;k.className="notif "+q;if(!e.parentNode){k.appendChild(e)}if(!k.parentNode){f.insertBefore(k,f.firstChild)}$(k).animate({top:"-5px"},{duration:500,complete:function(){o=true}});window.setTimeout(n,q==="error"?3000:2000)}b();m.textContent=c.edit;document.body.insertBefore(m,i);m.onclick=l});